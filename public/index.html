
<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">

  <title>My Car Location</title>
  <meta name="description" content="My Car Location">
  <meta name="author" content="SitePoint">


  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href= "https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">  
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
   integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
   crossorigin=""/>  
   <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
   integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
   crossorigin=""></script>

   <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.js"></script>
   <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></scr>
   <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.css">
   <link rel="stylesheet" href="css/m.css">
   <script src="js/app.js"></script>
   <script src="../src/leaflet-routerboxer.js"></script>
   <script src="lib/Polyline.encoded.js"></script>


   <script src="lib/jquery-3.2.1.js"></script>

   <script src="http://maxcdn.bootstrapcdn.com/bottstrap/4.3.1/js/bootstrap.min.js"></script>
   <style>
    
       @import url('//netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap-theme.min.css');

       #mapid { height: 550px; }
       #mapid { width: 100%; }
      

       p{
        font-size: 20px;  /*tamaÃ±o*/
        
        }

        table { width: 100%; }

   </style>





   
    <style type="text/css">
        .tg  {border-collapse:collapse;border-spacing:0;}
        .tg td{border-color:black;border-style:solid;border-width:1px;font-family:Arial, sans-serif;font-size:14px;
        overflow:hidden;padding:10px 5px;word-break:normal;}
        .tg th{border-color:black;border-style:solid;border-width:1px;font-family:Arial, sans-serif;font-size:14px;
        font-weight:normal;overflow:hidden;padding:10px 5px;word-break:normal;}
        .tg .tg-0lax{text-align:left;vertical-align:top}
        
    </style>

</head>

<body>
    <nav class="navbar navbar-dark bg dark">
      <div class="container">
        <h1 style="color: green">MY CAR LOCATION</h1> 
        <div class="well">Sistema de Geolocalización móvil</div> 
      </div>
    </nav>
	

	<script>

        let boundsSet = false; 

        const myMap = L.map('mapid').setView([10.9578, -74.792], 12);

        const attribution = '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors';

        const tileUrl = 'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png'

        const tiles = L.tileLayer(tileUrl,  { attribution }).addTo(myMap);
    	
	</script>




<nav class="navbar navbar-expand-lg navbar-light bg-light">
 
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavDropdown" aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>
  <div class="collapse navbar-collapse" id="navbarNavDropdown">
    <ul class="navbar-nav">
      <li class="nav-item active">
        <a class="nav-link" href="http://54.71.123.233:50001/">Inicio<span class="sr-only">(current)</span></a>
      </li>
      
      <li class="nav-item">
        <a class="nav-link" href="http://54.71.123.233:50001/liveMap/">Ubicación en vivo</a>
      </li>
      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdownMenuLink" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          Ubicación histórica
        </a>
        <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
          <a class="dropdown-item" href="http://54.71.123.233:50001/EEE-070/">EFE-070</a>
          <a class="dropdown-item" href="http://54.71.123.233:50001/ABC-425/">ABC-425</a>
          <a class="dropdown-item" href="http://54.71.123.233:50001/BTE-425/">BTE-425</a>
        </div>
      </li>
    </ul>
  </div>
</nav>



	<div id="map"></div>
        <div id="controls">
          <div class="container">
	   <div class="bg-secondary py-3 mb-4">
		<div class="col-lg-12">	
                 <div class="display-4 text-black mt-5 mb-5">¡Bienvenido!
		      <p class="lead mb-5 text-black-50">
                   	Aquí podrás rastrear tu vehículo en tiempo real, en el menú correspondiente ingresando
                        a 'Ubicación en vivo'. Para conocer la ruta recorrida en un intervalo de tiempo
                        determinado, ingresa a la pestaña 'Ubicación histórica'.
                        Para consultar sobre el código fuente de esta página ingresa al link adjunto para
                        acceder al
                    <a href="https://github.com/ddiazghub/geolocationServiceDis">
                        Repositorio</a>
                 </div>	
                       </p>
                        <!-- Place this tag where you want the button to render. -->
                        <a class="btn btn-primary btn-lg" href="https://github.com/ddiazghub" data-style="mega" aria-label="Star ddiazghub/geolocationServiceDise-o on GitHub">Go to Repository &raquo;</a>
			                        
                        <script>!function(d,s,id){var js,fjs=d.getElementsByTagName>				
	   	</div>
	   </div>
	  </div>
	</div>
	</div>


	<div class="container">
	 <div class="row">
	   <div class="col-md-8 mb-5">
	    <h2>Desarrolladores</h2>
	    <hr>
    	    <address>
	      <strong>Prueba</strong>
	      <br>Prueba 1
	      <abbr title="Email">E-mail:</abbr>
	      <a href="mailto:#">kamilah@uninorte.edu.co</a>
	    </address>	
	   </div>
	 </div>
	</div>
	







       

        const greenIcon = new L.Icon({
            iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-green.png',
            shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
            iconSize: [25, 41],
            iconAnchor: [12, 41],
            popupAnchor: [1, -34],
            shadowSize: [41, 41]
        });

        const redIcon = new L.Icon({
            iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-red.png',
            shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
            iconSize: [25, 41],
            iconAnchor: [12, 41],
            popupAnchor: [1, -34],
            shadowSize: [41, 41]
        });

        const marker_1 = L.marker([0, 0]).addTo(myMap);
        const marker_2 = L.marker([0, 0], {icon: greenIcon}).addTo(myMap);
        const marker_3 = L.marker([0, 0], {icon: redIcon}).addTo(myMap);

        getData();

        setInterval(getData, 5000);

        async function getData() {

            const response = await fetch('http://54.71.123.233:50001/vehicles');
            const jsonData = await response.json();
            
            vehicles = jsonData;
            console.log(vehicles);            
            updateMarkersAndText(vehicles);
        }

        function updateMarkersAndText(data) {

            document.getElementById('lat').innerHTML = vehicles[0].latitude;
            document.getElementById('lon').innerHTML = vehicles[0].longitude;
            document.getElementById('fec').innerHTML = vehicles[0].date;
            document.getElementById('hor').innerHTML = vehicles[0].time;
            marker_1.setLatLng([vehicles[0].latitude, vehicles[0].longitude]);
            marker_1.bindPopup("Placa: EFE-070").openPopup();

            document.getElementById('latitud').innerHTML = vehicles[1].latitude;
            document.getElementById('longitud').innerHTML = vehicles[1].longitude;
            document.getElementById('fecha').innerHTML = vehicles[1].date;
            document.getElementById('hora').textContent = vehicles[1].time;
            marker_2.setLatLng([vehicles[1].latitude, vehicles[1].longitude]);
            marker_2.bindPopup("Placa: ABC-425").openPopup();

            document.getElementById('latitude').textContent = vehicles[2].latitude;
            document.getElementById('longitude').textContent = vehicles[2].longitude;
            document.getElementById('date').textContent = vehicles[2].date;
            document.getElementById('time').textContent = vehicles[2].time;
            marker_3.setLatLng([vehicles[2].latitude, vehicles[2].longitude]);
            marker_3.bindPopup("Placa: BTE-425").openPopup();

            if (!boundsSet) {
              const group = new L.featureGroup([marker_1, marker_2, marker_3]);
              myMap.fitBounds(group.getBounds().pad(0.5));
              boundsSet = true;
            }

        }

        function splitIncomingData(data) {

	    const dataLines = data.split("\n")
            const dataSplit = ["", "", ""]
            for (const lines in dataLines) {
                dataSplit[lines] = dataLines[lines].split(" ");
            }
            return dataSplit;

	}

    <script>

      
    </script>
    
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
</body>
</html>
